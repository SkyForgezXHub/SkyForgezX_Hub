--[[
    SkyForgezX Hub v16.0 - INFINITY PRIME Edition (FIXED & STABLE)
    Producer: SkyForgezX
    Status: Working
    Fixes: Crash on inject, Mobile Button logic, VirtualUser removed
]]

-- === WAIT FOR GAME ===
if not game:IsLoaded() then game.Loaded:Wait() end

-- === SERVICES ===
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local CoreGui = game:GetService("CoreGui")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local StarterGui = game:GetService("StarterGui")
local VirtualInputManager = game:GetService("VirtualInputManager")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- === CONFIG ===
local Config = {
    FlySpeed = 50,
    WalkSpeed = 16,
    JumpPower = 50,
    RainbowUI = true,
    RobuxAmount = "∞"
}

local State = {
    Fly = false,
    Noclip = false,
    Aimbot = false,
    ESP = false,
    KillAura = false,
    GodMode = false,
    Fling = false
}

-- === UI LIBRARY (SAFE MODE) ===
local Library = {}

function Library:SafeGui()
    -- Executor desteğine göre güvenli GUI yeri seçimi
    local success, parent = pcall(function()
        if getgenv and (identifyexecutor or getexecutorname) then
            return CoreGui
        else
            return LocalPlayer:WaitForChild("PlayerGui")
        end
    end)
    return success and parent or LocalPlayer:WaitForChild("PlayerGui")
end

-- Eski GUI'yi Temizle
pcall(function()
    if Library:SafeGui():FindFirstChild("SkyInfinityPrime") then
        Library:SafeGui().SkyInfinityPrime:Destroy()
    end
end)

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SkyInfinityPrime"
ScreenGui.Parent = Library:SafeGui()
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false -- Ölünce gitmemesi için
ScreenGui.IgnoreGuiInset = true

-- BLUR
local Blur = Instance.new("BlurEffect")
Blur.Size = 0
Blur.Parent = Lighting

-- THEME
local Theme = {
    Main = Color3.fromRGB(170, 0, 255),
    Dark = Color3.fromRGB(12, 12, 12),
    Text = Color3.fromRGB(255, 255, 255),
    Sidebar = Color3.fromRGB(18, 18, 22)
}

-- NOTIFICATIONS
local NotifHolder = Instance.new("Frame")
NotifHolder.Size = UDim2.new(0, 300, 1, 0)
NotifHolder.Position = UDim2.new(1, -310, 0, 50)
NotifHolder.BackgroundTransparency = 1
NotifHolder.Parent = ScreenGui
local NotifLayout = Instance.new("UIListLayout")
NotifLayout.Padding = UDim.new(0, 10)
NotifLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
NotifLayout.Parent = NotifHolder

function Library:Notify(title, text)
    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(1, 0, 0, 0)
    Frame.BackgroundColor3 = Theme.Dark
    Frame.BorderSizePixel = 0
    Frame.Parent = NotifHolder
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 8)
    
    local Stroke = Instance.new("UIStroke")
    Stroke.Color = Theme.Main
    Stroke.Thickness = 1.5
    Stroke.Parent = Frame
    
    local T = Instance.new("TextLabel")
    T.Text = title
    T.Size = UDim2.new(1, -20, 0, 20)
    T.Position = UDim2.new(0, 10, 0, 5)
    T.BackgroundTransparency = 1
    T.TextColor3 = Theme.Main
    T.Font = Enum.Font.GothamBold
    T.TextSize = 14
    T.TextXAlignment = Enum.TextXAlignment.Left
    T.Parent = Frame
    
    local M = Instance.new("TextLabel")
    M.Text = text
    M.Size = UDim2.new(1, -20, 0, 20)
    M.Position = UDim2.new(0, 10, 0, 25)
    M.BackgroundTransparency = 1
    M.TextColor3 = Theme.Text
    M.Font = Enum.Font.Gotham
    M.TextSize = 12
    M.TextXAlignment = Enum.TextXAlignment.Left
    M.Parent = Frame
    
    TweenService:Create(Frame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Size = UDim2.new(1, 0, 0, 60)}):Play()
    task.delay(3, function()
        TweenService:Create(Frame, TweenInfo.new(0.5), {Size = UDim2.new(1,0,0,0)}
